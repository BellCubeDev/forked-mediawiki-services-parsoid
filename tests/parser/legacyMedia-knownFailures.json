{
	"2. Treebuilder fixup of formatting elt": {
		"wt2wt": "'''foo'''\n\n'''[[File:Foobar.jpg|thumb|caption]]'''\n\n'''bar'''\n\n<small>[[Image:Foobar.jpg|right|300px]]</small>"
	},
	"3. Treebuilder fixup of formatting elt": {
		"wt2wt": "<small>'''foo''''''[[File:Foobar.jpg|thumb|caption]]''''''bar'''</small>"
	},
	"Allow empty links in image captions (T62753)": {
		"wt2wt": "[[File:Foobar.jpg|thumb|Caption [[Link1]]\n<nowiki>[[]]</nowiki>\n[[Link2]]\n]]"
	},
	"Don't break gallery if language converter markup is inside.": {
		"wt2html": "<ul class=\"gallery mw-gallery-traditional\" typeof=\"mw:Extension/gallery\" about=\"#mwt5\" data-parsoid='{\"dsr\":[0,172,9,10]}' data-mw='{\"name\":\"gallery\",\"attrs\":{},\"body\":{}}'>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File mw:ExpandedAttrs\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"alt\",\"ak\":\"alt=-{R|bat}-\"},{\"ck\":\"caption\",\"ak\":\"[[File:foobar.jpg|20px|desc|alt=-{R|foo}-|-{R|bar}-]]\"}]}' data-mw='{\"attribs\":[[\"alt\",{\"html\":\"alt=&lt;span typeof=\\\"mw:LanguageVariant\\\" data-mw-variant=&apos;{\\\"disabled\\\":{\\\"t\\\":\\\"bat\\\"}}&apos; data-parsoid=&apos;{\\\"fl\\\":[\\\"R\\\"],\\\"dsr\\\":[30,39,2,2]}&apos;>&lt;/span>\",\"txt\":\"\"}]]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img alt=\"\" resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[40,93,0,0]}'><span typeof=\"mw:File mw:ExpandedAttrs\" about=\"#mwt2\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"20px\"},{\"ck\":\"bogus\",\"ak\":\"desc\"},{\"ck\":\"alt\",\"ak\":\"alt=-{R|foo}-\"},{\"ck\":\"caption\",\"ak\":\"-{R|bar}-\"}],\"dsr\":[40,93,null,null]}' data-mw='{\"attribs\":[[\"alt\",{\"html\":\"alt=&lt;span typeof=\\\"mw:LanguageVariant\\\" data-mw-variant=&apos;{\\\"disabled\\\":{\\\"t\\\":\\\"foo\\\"}}&apos; data-parsoid=&apos;{\\\"fl\\\":[\\\"R\\\"],\\\"dsr\\\":[72,81,2,2]}&apos;>&lt;/span>\",\"txt\":\"\"}]],\"caption\":\"&lt;span typeof=\\\"mw:LanguageVariant\\\" data-mw-variant=&apos;{\\\"disabled\\\":{\\\"t\\\":\\\"bar\\\"}}&apos; data-parsoid=&apos;{\\\"fl\\\":[\\\"R\\\"],\\\"dsr\\\":[82,91,2,2]}&apos;>&lt;/span>\"}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img alt=\"\" resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/20px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"2\" width=\"20\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/30px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/40px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"2\",\"width\":\"20\"},\"sa\":{\"resource\":\"File:foobar.jpg\"}}'/></a></span></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"alt\",\"ak\":\"alt=galleryalt\"},{\"ck\":\"caption\",\"ak\":\"{{Test|unamedParam|alt=-{R|param}-}}\"}]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" title=\"This is a test template\" data-parsoid=\"{}\"><img alt=\"galleryalt\" resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[125,161,0,0]}'><span about=\"#mwt4\" typeof=\"mw:Transclusion\" data-parsoid='{\"pi\":[[{\"k\":\"1\"},{\"k\":\"alt\",\"named\":true}]],\"dsr\":[125,161,null,null]}' data-mw='{\"parts\":[{\"template\":{\"target\":{\"wt\":\"Test\",\"href\":\"./Template:Test\"},\"params\":{\"1\":{\"wt\":\"unamedParam\"},\"alt\":{\"wt\":\"-{R|param}-\"}},\"i\":0}}]}'>This is a test template</span></div></li>\n</ul>"
	},
	"Gallery (with showfilename option)": {
		"wt2html": "<ul class=\"gallery mw-gallery-traditional\" typeof=\"mw:Extension/gallery\" about=\"#mwt2\" data-parsoid='{\"dsr\":[0,179,25,10]}' data-mw='{\"name\":\"gallery\",\"attrs\":{\"showfilename\":\"\"},\"body\":{}}'>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:Error mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"caption\",\"ak\":\"caption\"}]}' data-mw='{\"errors\":[{\"key\":\"apierror-filedoesnotexist\",\"message\":\"This image does not exist.\"}]}'><a href=\"./Special:FilePath/Nonexistent.jpg\" data-parsoid=\"{}\"><span class=\"mw-broken-media\" resource=\"./File:Nonexistent.jpg\" data-width=\"120\" data-height=\"120\" data-parsoid='{\"a\":{\"resource\":\"./File:Nonexistent.jpg\"},\"sa\":{\"resource\":\"File:Nonexistent.jpg\"}}'>File:Nonexistent.jpg</span></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[47,54,0,0]}'><a href=\"./File:Nonexistent.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Nonexistent.jpg\" data-parsoid=\"{}\">File:Nonexistent.jpg</a>caption</div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:Error mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"}]}' data-mw='{\"errors\":[{\"key\":\"apierror-filedoesnotexist\",\"message\":\"This image does not exist.\"}]}'><a href=\"./Special:FilePath/Nonexistent.jpg\" data-parsoid=\"{}\"><span class=\"mw-broken-media\" resource=\"./File:Nonexistent.jpg\" data-width=\"120\" data-height=\"120\" data-parsoid='{\"a\":{\"resource\":\"./File:Nonexistent.jpg\"},\"sa\":{\"resource\":\"File:Nonexistent.jpg\"}}'>File:Nonexistent.jpg</span></a></span></div><div class=\"gallerytext\" data-parsoid=\"{}\"><a href=\"./File:Nonexistent.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Nonexistent.jpg\" data-parsoid=\"{}\">File:Nonexistent.jpg</a></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"caption\",\"ak\":\"some &apos;&apos;&apos;caption&apos;&apos;&apos; [[Main Page]]\"}]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" title=\"some caption Main Page\" data-parsoid=\"{}\"><img alt=\"some caption Main Page\" resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[92,124,0,0]}'><a href=\"./File:Foobar.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Foobar.jpg\" data-parsoid=\"{}\">File:Foobar.jpg</a>some <b data-parsoid='{\"dsr\":[97,110,3,3]}'>caption</b> <a rel=\"mw:WikiLink\" href=\"./Main_Page\" title=\"Main Page\" data-parsoid='{\"stx\":\"simple\",\"a\":{\"href\":\"./Main_Page\"},\"sa\":{\"href\":\"Main Page\"},\"dsr\":[111,124,2,2]}'>Main Page</a></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"}]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid=\"{}\"><a href=\"./File:Foobar.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Foobar.jpg\" data-parsoid=\"{}\">File:Foobar.jpg</a></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"}]}'><a href=\"./File:Redirect_to_foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img resource=\"./File:Redirect_to_foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Redirect_to_foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Redirect_to_foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid=\"{}\"><a href=\"./File:Redirect_to_foobar.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Redirect_to_foobar.jpg\" data-parsoid=\"{}\">File:Redirect_to_foobar.jpg</a></div></li>\n</ul>",
		"wt2wt": "<gallery showfilename=\"\">\nFile:Nonexistent.jpg|caption\nFile:Nonexistent.jpg\nFile:Foobar.jpg|some '''caption''' [[Main Page]]\nFile:Foobar.jpg\nFile:Redirect_to_foobar.jpg\n</gallery>"
	},
	"Image with multiple attributes from the same template": {
		"wt2wt": "[[File:Foobar.jpg|right|Caption text]]"
	},
	"Image: upright option is ignored on inline and frame images (parsoid)": {
		"wt2wt": "[[File:Foobar.jpg|500x500px|caption]]"
	},
	"Simple image redirect": {
		"wt2html": "<p data-parsoid='{\"dsr\":[0,32,0,0]}'><span class=\"mw-default-size\" typeof=\"mw:File\" data-parsoid='{\"optList\":[],\"dsr\":[0,32,null,null]}'><a href=\"./File:Redirect_to_foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img resource=\"./File:Redirect_to_foobar.jpg\" src=\"http://example.com/images/3/3a/Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"220\" width=\"1941\" data-parsoid='{\"a\":{\"resource\":\"./File:Redirect_to_foobar.jpg\",\"height\":\"220\",\"width\":\"1941\"},\"sa\":{\"resource\":\"Image:Redirect to foobar.jpg\"}}'/></a></span></p>"
	}
}
